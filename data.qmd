# Data

## Description
Our primary data source is the PISA dataset published by the Organization for Economic Cooperation and Development (OECD). The OECD is an international organization that develops standards that allow for more evidence based policies across the globe, including educational standards. Given its established reputation and collaboration with official governmental educational institutions, we believe this is a credible source.

Disregarding a delay due to the pandemic, the PISA assessment is conducted once every three years and aims to evaluate the knowledge and skills of 15-year-old students in reading, mathematics, and science. By simulating real-world situations, the test aims to determine whether students can apply their knowledge rather than merely memorizing. The data is collected through a standardized testing approach with consistent administration environments in each country participating in the data collection. This ensures that it can be compared across countries.

For this project’s analysis, we will be using the PISA data from 2018 (pre-pandemic) and 2022 (post-pandemic) which are available on the published PISA reports on the OECD official website. The datasets are provided in XLSX formats with each file containing each country, their corresponding PISA scores, and country statistics (like GDP and education spending).

In the report, there are many different tables and datasets that are available for our use. We want to use the table where we have the average scores for each country, ranked from highest to lowest. PISA 2018 was last updated in December 2019, but there is no definite update date for PISA 2022, which we can assume to be sometime around the end of 2022. 

One issue with the data is that though the OECD strives to maintain consistency across years, the pandemic caused various disruptions which, though documented clearly, could introduce noise into some cross country comparisons. However, this project is focusing on change from pre- to post-pandemic so cross country comparisons will be seldom made. 

Something we want to be cognizant of is the fact that these scores might be fluctuating over the years due to other factors independent of the pandemic. To take care of this, we are planning to look into other data sources. 

Data:

https://www.oecd.org/en/publications/pisa-2018-results-volume-i_5f07c754-en.html 

https://www.oecd.org/en/data/datasets/pisa-2022-database.html 

Besides overarching global comparisons, we wanted to dive deeper into a few countries and analyze what actions they took regarding education during the pandemic and how that might explain their difference in PISA scores.

Finland: 

For Finland, we found various datasets in research papers looking for the effect of the pandemic on education in Finland. 

The first paper we found was written by Harvard’s Department of Education and published in 2023. It provides several analyses of student/teacher engagement, burnout, and general attitudes throughout the pandemic. 

Data: 

https://link.springer.com/chapter/10.1007/978-3-031-42671-1_4

https://link.springer.com/article/10.1007/s10902-022-00518-1/tables/3 

Our second source is a report from the OECD which we’ve already explained is a highly credible source, and was published in December of 2020. This source puts together several data sources that discuss the actions Finland took to switch to distance learning and the impact of them.

Data:

https://www.oecd.org/content/dam/oecd/en/about/projects/edu/education-policy-outlook/covid-snapshot-Finland.pdf 

United States:

In addition to Finland, we decided to look into data from the US. Google has health data for COVID-19 that is credible and verified. It is one of the largest collections of COVID data available to use, compiled from various sources. Through this dataset, we can examine how the different factors, such as socioeconomic factors, can affect how the virus affected various groups of people, giving us a better understanding of the effects of the pandemic. 

Data: https://health.google.com/covid-19/open-data/raw-data

The 2021-2022 School Learning Modalities dataset contains information about the learning modality for primary and secondary schools. The data was aggregated from multiple data sources to determine the likely learning modality of the school district. The data was provided by the CDC. 

Data: https://healthdata.gov/National/School-Learning-Modalities-2021-2022/aitj-yx37/about_data

The final dataset is from the National Center for Education Statistics and it is data regarding the U.S. education at the time of COVID. There’s a variety of data regarding the activities of people during this time, such as the number of adults with children who had their students attending summer programs or working with private tutors. We hope to use this data to gain more data about the ways students and parents coped with the changes in education during this turbulent time.

Data: https://nces.ed.gov/surveys/annualreports/topical-studies/covid/ 

## Required Packages and Data Loading

```{r}
# install.packages(c("dplyr","tidyr","ggplot2","ggalluvial","forcats",'ggtext'))
library(dplyr) 
library(tidyr)
library(tidyverse)
library(ggplot2)
library(ggalluvial)
library(forcats)
library(ggridges)
#library(Lock5withR)

```




```{r}
# Loading in the PISA datasets:
pisa2009 <- read.csv('data/2009_PISA.csv')
pisa2012 <- read.csv('data/2012_PISA.csv')
pisa2015 <- read.csv('data/2015_PISA.csv')
pisa2018 <- read.csv('data/2018_PISA.csv')
pisa2022 <- read.csv('data/2022_PISA.csv')
```


## Missing value analysis

** dont have it for a couple of years --> alluvial 

```{r}

# List of country participation across years:
participation_list <- list(
  '2009' = pisa2009$X,
  '2012' = pisa2012$Country,
  '2015' = pisa2015$X,
  '2018' = pisa2018$Country,
  '2022' = pisa2022$Country
)

# row and column values
all_countries <- unique(unlist(participation_list))
years <- names(participation_list)

# dataframe used for alluvial
participation_long <- participation_list |>
  enframe(name = "year", value = "country") |>
  unnest(country) |>
  mutate(status = "participated")

participation_df <- participation_long |>
  pivot_wider(
    names_from = year,
    values_from = status,
    values_fn = ~ first(.x)
    # values_fill = "not participated"
  ) 

participation_df$`2009` <- replace_na(participation_df$`2009`, "not participated")
participation_df$`2012` <- replace_na(participation_df$`2012`, "not participated")
participation_df$`2015` <- replace_na(participation_df$`2015`, "not participated")
participation_df$`2018` <- replace_na(participation_df$`2018`, "not participated")
participation_df$`2022` <- replace_na(participation_df$`2022`, "not participated")

participation_df$total_participated <- as.factor(rowSums(participation_df[, -1] == "participated", na.rm = TRUE))
```

```{r}
ggplot(data = participation_df,
       aes(axis1 = `2009`, axis2 = `2012`, axis3 = `2015`, axis4 = `2018`, axis5=`2022`)) +
  geom_alluvium(aes(fill = total_participated), alpha = 0.7) +
  geom_stratum(alpha = 0.9) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 3) +
  scale_x_discrete(limits = c("2009", "2012", "2015", "2018", "2022"), 
                   expand = c(0.15, 0.05)) +
  theme_minimal() +
  labs(title = "Country Participation Over Time",
       y = "Number of Countries") +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
        axis.title.x = element_blank())
```

# total_participated --> column with the num of times a country had PISA 
# participation_long --> df for every country that was there for all the years 

```{r}
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(patchwork)

country_counts <- participation_long %>%
  group_by(country) %>%
  summarise(count_status = n(), .groups = 'drop') 

name_fix <- c(
  "United States" = "United States of America",
  # The following must be explicitly named:
  "Hong Kong-China" = "China", 
  "Shanghai-China" = "China",
  "Chinese Taipei" = "China",
  # The rest of the vector was already correctly structured:
  "South Korea" = "Korea, Republic of",
  "North Korea" = "Korea, Democratic People's Republic of",
  "Iran" = "Iran, Islamic Republic of",
  "Vietnam" = "Viet Nam",
  "Egypt" = "Egypt, Arab Republic of",
  "Czech Republic" = "Czechia",
  "Syria" = "Syrian Arab Republic",
  "Bolivia" = "Bolivia (Plurinational State of)",
  "Brunei Darussalam" = "Brunei",
  "Slovak Republic" = "Slovakia",
  "Korea" = "Korea, Republic of", 
  "Baku (Azerbaijan)" = "Azerbaijan",
  "Moldova" = "Republic of Moldova", 
  "Kosovo" = "Kosovo")

country_counts$country_fixed <- recode(country_counts$country, !!!name_fix, .default = country_counts$country)


world <- ne_countries(scale = "medium", returnclass = "sf")

world_data <- world %>%
  left_join(country_counts, by = c("name" = "country_fixed")) %>%
  mutate(count_status_factor = factor(count_status))


map_pisa <- ggplot(world_data) +
  geom_sf(aes(fill = count_status_factor), color = "white", size = 0.1) +
  scale_fill_viridis_d(option = "plasma", 
                       na.value = "gray90",
                       name = "Participation Count") + 
  labs(
    title = "Student Participation Count by Country",
    fill = "count_status"
  ) +
  theme_minimal() +
  # Optional: Clean up map theme
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    panel.grid.major = element_line(colour = "transparent")
  )

map_pisa

```





