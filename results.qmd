# Results

- PISA scores for US vs finland 
- GDP vs pisa
- spending vs pisa 
### global trends 
- missing data (separate thing)
- distributions of each year's scores ridgeline plot (1)
```{r}
all_reading_scores <- list(
  `2009` = pisa2009$On.the.overall.reading.scale,
  `2012` = pisa2012$Mean.score.in.PISA.2012...Reading,
  `2015` = pisa2015$Mean.score.in.PISA.2015...Reading,
  `2018` = pisa2018$Reading.Mean,
  `2022` = pisa2022$Reading.Mean
)

all_math_scores <- list(
  `2009` = pisa2009$On.the.mathematics.scale,
  `2012` = pisa2012$Mean.score.in.PISA.2012...Mathematics,
  `2015` = pisa2015$Mean.score.in.PISA.2015...Mathematics,
  `2018` = pisa2018$Mathematics.Mean,
  `2022` = pisa2022$Mathematics.Mean
)

all_science_scores <- list(
  `2009` = pisa2009$On.the.overall.science.scale,
  `2012` = pisa2012$Mean.score.in.PISA.2012...Science,
  `2015` = pisa2015$Mean.score.in.PISA.2015...Science,
  `2018` = pisa2018$Science.Mean,
  `2022` = pisa2022$Science.Mean
)

all_scores <- data.frame(country = all_countries) |>
  left_join(select(pisa2009, X, On.the.overall.reading.scale), by=c("country" = "X")) |>
  left_join(select(pisa2012, Country, Mean.score.in.PISA.2012...Reading), by=c("country" = "Country")) |>
  left_join(select(pisa2015, X, Mean.score.in.PISA.2015...Reading), by=c("country" = "X")) |>
  left_join(select(pisa2018, Country, Reading.Mean), by=c("country" = "Country")) |>
  left_join(select(pisa2022, Country, Reading.Mean), by=c("country" = "Country")) |>
  rename(`2009`=On.the.overall.reading.scale, `2012`=Mean.score.in.PISA.2012...Reading, `2015`=Mean.score.in.PISA.2015...Reading, `2018`=Reading.Mean.x, `2022`=Reading.Mean.y) |>
  mutate(across(c(`2009`, `2012`, `2015`, `2018`, `2022`), as.numeric))
  
all_scores_long <- all_scores |>
  pivot_longer(!country, names_to="year", values_to="score")

all_scores_long
```

```{r}
ggplot(all_scores_long, aes(x = score, y = fct_reorder(year, score, .fun = median))) +
  geom_density_ridges(fill = "blue") +
  ggtitle("Overall PISA Scores Over Time") +
  ylab("year")
```


- cleavland dot plot of all countries scores 2018 and 2022 (1)
```{r}
all_scores_long |>
  filter(year > 2017) |>
  filter(!is.na(score)) |>
  ggplot(aes(x = score, y = fct_reorder2(country, year=="2022", score), color=as.factor(year))) +
  geom_point(alpha=0.5) +
  ggtitle("PISA Scores in 2018 vs. 2022") +
  ylab("") +
  theme_linedraw()
```



- line plot of the the average scores over time (1)
```{r}
# Reading scores data
reading_scores <- list(
  # `2009` = mean(pisa2009$On.the.overall.reading.scale),
  `2012` = filter(pisa2012, Country == 'OECD average')$Mean.score.in.PISA.2012...Reading,
  `2015` = filter(pisa2015, X == 'OECD average')$Mean.score.in.PISA.2015...Reading,
  `2018` = filter(pisa2018, Country == 'OECD average')$Reading.Mean,
  `2022` = filter(pisa2022, Country == 'OECD average')$Reading.Mean
)

reading_scores_df <- data.frame(
  year = as.numeric(names(reading_scores)),
  reading_score = as.numeric(unlist(reading_scores)),
  row.names = NULL
)

# Mathematics scores data
math_scores <- list(
  # `2009` = mean(pisa2009$On.the.mathematics.scale),
  `2012` = filter(pisa2012, Country == 'OECD average')$Mean.score.in.PISA.2012...Mathematics,
  `2015` = filter(pisa2015, X == 'OECD average')$Mean.score.in.PISA.2015...Mathematics,
  `2018` = filter(pisa2018, Country == 'OECD average')$Mathematics.Mean,
  `2022` = filter(pisa2022, Country == 'OECD average')$Mathematics.Mean
)

math_scores_df <- data.frame(
  year = as.numeric(names(math_scores)),
  math_score = as.numeric(unlist(math_scores)),
  row.names = NULL
)
# Science scores data
science_scores <- list(
  # `2009` = mean(pisa2009$On.the.science.scale),
  `2012` = filter(pisa2012, Country == 'OECD average')$Mean.score.in.PISA.2012...Science,
  `2015` = filter(pisa2015, X == 'OECD average')$Mean.score.in.PISA.2015...Science,
  `2018` = filter(pisa2018, Country == 'OECD average')$Science.Mean,
  `2022` = filter(pisa2022, Country == 'OECD average')$Science.Mean
)

science_scores_df <- data.frame(
  year = as.numeric(names(science_scores)),
  science_score = as.numeric(unlist(science_scores)),
  row.names = NULL
)
```

```{r}
# Plotting scores
ggplot(reading_scores_df, aes(year, reading_score)) + 
  geom_point() +
  geom_point() + 
  labs(x = "Year", y = "OECD Average Reading Scores") +
  ggtitle("OECD Average Reading Scores from 2012-2022")

ggplot(math_scores_df, aes(x=year, y=math_score)) + 
  geom_bar(stat = "identity") +
  labs(x = "Year", y = "OECD Average Math Scores") +
  ggtitle("OECD Average Math Scores from 2012-2022")

ggplot(science_scores_df, aes(year, science_score)) + 
  geom_point() +
  labs(x = "Year", y = "OECD Average Science Scores") +
  ggtitle("OECD Average Science Scores from 2012-2022")
```

- interesting to predict what 2022 would be given 2009-2018 (1) 

```{r}
# Reading Predictions
reading_scores_train <- reading_scores_df |>
  filter(year < 2020)
reading_model <- lm(reading_score ~ year, data = reading_scores_train)

# Predict for 2022
predicted_value <- predict(reading_model, newdata = data.frame(year = 2022))
print(predicted_value)

# Plot new model
ggplot(reading_scores_train, aes(year, reading_score)) + 
  geom_point(data=reading_scores_df, aes(year, reading_score)) +
  geom_smooth(method="lm") + 
  geom_abline(intercept = coef(reading_model)[1], slope = coef(reading_model)[2], 
              color = "blue", linewidth = 1) +
  labs(x = "Year", y = "OECD Average Reading Scores") +
  ggtitle("Predicting 2022 OECD Average Reading Score")
```

```{r}
# Math Predictions
math_scores_train <- math_scores_df |>
  filter(year < 2020)
math_model <- lm(math_score ~ year, data = math_scores_train)

# Predict for 2022
predicted_value <- predict(math_model, newdata = data.frame(year = 2022))
print(predicted_value)

# Plot new model
ggplot(math_scores_train, aes(year, math_score)) + 
  geom_point(data=math_scores_df, aes(year, math_score)) +
  geom_smooth(method="lm") + 
  geom_abline(intercept = coef(math_model)[1], slope = coef(math_model)[2], 
              color = "blue", linewidth = 1) +
  labs(x = "Year", y = "OECD Average Math Scores") +
  ggtitle("Predicting 2022 OECD Average Math Score")
```

- GDP for 2018 vs 2022 (1)

- spending for 2018 vs 2022 (1)

---> shit on countries 
---> see if there is a correlation between COVID and GDP, COVID and spending


```{r}
GDP_precovid<- read.csv('data/2018_GDP.csv')
spending_precovid<- read.csv('data/2018_Spending.csv')

merged_data <- merge(GDP_precovid, spending_precovid, by = "Country")
```




```{r}
library(ggplot2)
library(ggrepel)
library(scales) # Required for label_number()

# Define the specific countries you want to label
target_countries <- c("Qatar", "Macao (China)", "Singapore", "Austria", "Iceland",'Finland')

ggplot(merged_data, aes(x = GDP, y = Spending)) +
  geom_point(color = "blue", size = 2) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey50") +
  geom_smooth(method = "lm", se = FALSE, color = "darkred") +
  
  geom_text_repel(
    # Filter data to only label the target countries
    data = merged_data[merged_data$Country %in% target_countries, ], 
    aes(label = Country), 
    size = 3,                       
    segment.color = 'grey50',       
    segment.size = 0.2,             
    box.padding = unit(0.5, "lines"), 
    point.padding = unit(0.5, "lines"),
    force = 2
  ) +
  
  # Set X-axis limits and format (NO scientific notation)
  scale_x_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data$GDP) * 1.05) # Incorporate the limit here
  ) +
  
  # Set Y-axis limits and format (NO scientific notation)
  scale_y_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data$Spending) * 1.05) # Incorporate the limit here
  ) +
  
  # Labels and Theme
  labs(
    title = "GDP vs. Spending Correlation (2018) - Selected Countries Highlighted",
    x = "GDP (in currency units from table)",
    y = "Spending (in currency units from table)",
    caption = "Linear trend line (dark red) shows relationship. Dashed line (grey) is y=x."
  ) +
  theme_minimal() 

# dashed is y = x
```
```{r}

GDP_postcovid<- read.csv('data/2022_GDP.csv')
spending_postcovid<- read.csv('data/2022_Spending.csv')

merged_data2 <- merge(GDP_postcovid, spending_postcovid, by = "Country")
names(merged_data2)[2] <- "GDP"
```

```{r}
library(ggplot2)
library(ggrepel)
library(scales) # Required for label_number()

# Define the specific countries you want to label
target_countries <- c("Qatar", "Macao (China)", "Luxembourg", "Singapore", "Austria", "Iceland", 'Finland')

ggplot(merged_data2, aes(x = GDP, y = Spending)) +
  geom_point(color = "blue", size = 2) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey50") +
  geom_smooth(method = "lm", se = FALSE, color = "darkred") +
  
  geom_text_repel(
    # Filter data to only label the target countries
    data = merged_data2[merged_data2$Country %in% target_countries, ], 
    aes(label = Country), 
    size = 3,                       
    segment.color = 'grey50',       
    segment.size = 0.2,             
    box.padding = unit(0.5, "lines"), 
    point.padding = unit(0.5, "lines"),
    force = 2
  ) +
  
  # Set X-axis limits and format (NO scientific notation)
  scale_x_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data2$GDP) * 1.05) # Incorporate the limit here
  ) +
  
  # Set Y-axis limits and format (NO scientific notation)
  scale_y_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data2$Spending) * 1.05) # Incorporate the limit here
  ) +
  
  # Labels and Theme
  labs(
    title = "GDP vs. Spending Correlation (2018) - Selected Countries Highlighted",
    x = "GDP (in currency units from table)",
    y = "Spending (in currency units from table)",
    caption = "Linear trend line (dark red) shows relationship. Dashed line (grey) is y=x."
  ) +
  theme_minimal() 

# dashed is y = x
```



#### school modality 
- bar graph for the states (1)
- mosaic for the modality (3 categories) (1)

```{r}

#### school modality 
library(dplyr)
library(forcats)
library(vcd)
#https://healthdata.gov/browse?q=school+learning+modalities&sortBy=relevance&pageSize=20

df <- read.csv("data/school_modality.csv") |>
  mutate(
    Learning_Modality = as.factor(Learning_Modality),
    Year = as.factor(Year)
  )

counts <- df |>
  group_by(Year, Learning_Modality) |>
  summarize(Freq = sum(Count), .groups = "drop")

tbl <- xtabs(Freq ~ Year + Learning_Modality, data = counts)

colors_theme <- c("#FFB6B9", "#FAE3D9", "#61C0BF")

mosaic(
  tbl,
  direction = c("v", "h"),
  highlighting = "Learning_Modality",
  highlighting_fill = colors_theme,
  main = "Learning Modality by Year")
```
```{r}
data <- read.csv("data/school_burnout_finland.csv")
data <- data %>%
  rename(
    High_school = colnames(data)[4]
  )
usa_burnout <- read.csv("data/USA_burnout.csv")

names(usa_burnout)[2] <- "High School"
names(data)[4] <- "High School"

merged_data_burnout <- merge(usa_burnout, data, by = "Year")

names(merged_data_burnout)[2] <- 'USA'
names(merged_data_burnout)[5] <- 'Finland'

data_subset <- merged_data_burnout %>%
  select('Year', 'USA', 'Finland')

```


```{r}

library(tidyverse)
library(ggplot2)

data_long <- data_subset %>%
  pivot_longer(
    cols = c("USA", "Finland"),
    names_to = "Country",
    values_to = "Percent"
  )

# 4. Create the Line Plot using ggplot2
# Option A: Recommended Method (using expand_limits)
ggplot(data = data_long, aes(x = Year, y = Percent, color = Country)) +
  geom_line(linewidth = 1) + 
  geom_point(size = 3) + 
  
  # ðŸ‘‡ This forces the y-axis to include 0
  expand_limits(y = 0) + 
  
  # Add labels and theme... (rest of the code remains the same)
  labs(
    title = "Student Burnout (Persistent Sadness) Trends: USA vs. Finland",
    y = "Percent of Students (%)",
    x = "Year"
  ) +
  theme_minimal() +
  
  # Customize the color legend title
  scale_color_discrete(name = "Country")
```

```{r}
data_cynicism <- read.csv("data/cynicism_finland.csv")
data_cynicism <- data_cynicism %>%
  rename(
    Comprehensive = colnames(data_cynicism)[3],
    High_school = colnames(data_cynicism)[4],
    Vocational = colnames(data_cynicism)[5]
  )

# Load the necessary libraries (if not already loaded)
library(tidyr) 
library(ggplot2)

# Convert data to long format for easier plotting
data_cynicism_long <- data_cynicism %>%
  pivot_longer(
    # Select the three school columns for pivoting
    cols = c(Comprehensive, High_school, Vocational),
    names_to = "School_Type",
    values_to = "Percentage"
  )


color_map <- c(
  "Comprehensive" = "#377EB8",    # Darker Blue
  "High_school" = "#6495ED",      # Lighter Blue/Teal
  "Vocational" = "#800080"        # Purple/Maroon
)

label_map <- c(
  "Comprehensive" = "Comprehensive school grades 8 and 9",
  "High_school" = "High school grades 10 and 11",
  "Vocational" = "Vocational school"
)

# Create the plot
cynicism_plot <- ggplot(data_cynicism_long, aes(x = Year, y = Percentage, color = School_Type)) +
  # Add the lines
  geom_line(linewidth = 1) +
  # Add the points (circles)
  geom_point(size = 3) +
  
  # Set the custom colors and labels for the legend
  scale_color_manual(
    values = color_map, 
    labels = label_map,
    name = NULL # Remove legend title
  ) +
  
  # Customize the X-axis (Years)
  scale_x_continuous(
    breaks = data_cynicism$Year,
    # Use the custom labels, noting 2013 and 2017 are single years in this set
    labels = c("2007", "2009", "2011", "2013", "2017", "2019", "2021"),
    expand = expansion(add = c(0.5, 0.5))
  ) +
  
  # Customize the Y-axis (Percentage) - Adjusted for higher values
  scale_y_continuous(
    limits = c(0, 40), # Set the y-axis range to accommodate up to 35.5
    breaks = seq(0, 40, by = 5) # Set breaks every 5 units
  ) +
  
  # Add labels
  labs(
    x = "Year",
    y = "Percentage of students reporting cynicism"
  ) +
  
  # Apply the clean theme
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.title = element_text(size = 12, face = "bold"),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "grey80"),
    panel.grid.minor = element_blank()
  )

# Display the plot
print(cynicism_plot)
```



