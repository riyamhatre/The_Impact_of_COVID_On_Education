# Results
### global trends 
- missing data (separate thing)
- distributions of each year's scores ridgeline plot (1)
```{r}
# Reading Scores Full Table
all_reading_scores <- data.frame(country = all_countries) |>
  left_join(select(pisa2009, X, On.the.overall.reading.scale), by=c("country" = "X")) |>
  left_join(select(pisa2012, Country, Mean.score.in.PISA.2012...Reading), by=c("country" = "Country")) |>
  left_join(select(pisa2015, X, Mean.score.in.PISA.2015...Reading), by=c("country" = "X")) |>
  left_join(select(pisa2018, Country, Reading.Mean), by=c("country" = "Country")) |>
  left_join(select(pisa2022, Country, Reading.Mean), by=c("country" = "Country")) |>
  rename(`2009`=On.the.overall.reading.scale, `2012`=Mean.score.in.PISA.2012...Reading, `2015`=Mean.score.in.PISA.2015...Reading, `2018`=Reading.Mean.x, `2022`=Reading.Mean.y) |>
  mutate(across(c(`2009`, `2012`, `2015`, `2018`, `2022`), as.numeric))
  
all_reading_scores_long <- all_reading_scores |>
  pivot_longer(!country, names_to="year", values_to="score") |>
  mutate(across(c(year), as.numeric))

# Math Scores Full Table
all_math_scores <- data.frame(country = all_countries) |>
  left_join(select(pisa2009, X, On.the.mathematics.scale), by=c("country" = "X")) |>
  left_join(select(pisa2012, Country, Mean.score.in.PISA.2012...Mathematics), by=c("country" = "Country")) |>
  left_join(select(pisa2015, X, Mean.score.in.PISA.2015...Mathematics), by=c("country" = "X")) |>
  left_join(select(pisa2018, Country, Mathematics.Mean), by=c("country" = "Country")) |>
  left_join(select(pisa2022, Country, Mathematics.Mean), by=c("country" = "Country")) |>
  rename(`2009`=On.the.mathematics.scale, `2012`=Mean.score.in.PISA.2012...Mathematics, `2015`=Mean.score.in.PISA.2015...Mathematics, `2018`=Mathematics.Mean.x, `2022`=Mathematics.Mean.y) |>
  mutate(across(c(`2009`, `2012`, `2015`, `2018`, `2022`), as.numeric))
  
all_math_scores_long <- all_math_scores |>
  pivot_longer(!country, names_to="year", values_to="score") |>
  mutate(across(c(year), as.numeric))

# Science Scores Full Table
all_science_scores <- data.frame(country = all_countries) |>
  left_join(select(pisa2009, X, On.the.science.scale), by=c("country" = "X")) |>
  left_join(select(pisa2012, Country, Mean.score.in.PISA.2012...Science), by=c("country" = "Country")) |>
  left_join(select(pisa2015, X, Mean.score.in.PISA.2015...Science), by=c("country" = "X")) |>
  left_join(select(pisa2018, Country, Science.Mean), by=c("country" = "Country")) |>
  left_join(select(pisa2022, Country, Science.Mean), by=c("country" = "Country")) |>
  rename(`2009`=On.the.science.scale, `2012`=Mean.score.in.PISA.2012...Science, `2015`=Mean.score.in.PISA.2015...Science, `2018`=Science.Mean.x, `2022`=Science.Mean.y) |>
  mutate(across(c(`2009`, `2012`, `2015`, `2018`, `2022`), as.numeric))
  
all_science_scores_long <- all_science_scores |>
  pivot_longer(!country, names_to="year", values_to="score") |>
  mutate(across(c(year), as.numeric))

# Combining all scores
all_scores_long <- bind_rows(
  mutate(all_reading_scores_long, subject = "reading"),
  mutate(all_math_scores_long, subject = "math"),
  mutate(all_science_scores_long, subject = "science")
)
```

```{r}
ggplot(all_scores_long, aes(x = score, y = as.factor(year))) +
  geom_density_ridges(fill = "blue") +
  ggtitle("Overall PISA Scores Over Time") +
  ylab("year")
```


- cleavland dot plot of all countries scores 2018 and 2022 (1)
```{r}
all_scores_long |>
  filter(year > 2017) |>
  filter(!is.na(score)) |>
  ggplot(aes(x = score, y = fct_reorder2(country, year=="2022", score), color=as.factor(year))) +
  geom_point(alpha=0.5) +
  ggtitle("PISA Scores in 2018 vs. 2022") +
  ylab("") +
  theme_linedraw()
```



- line plot of the the average scores over time (1)


```{r}
# Plotting scores
ggplot(filter(all_reading_scores_long, country == "OECD average"), aes(year, score)) + 
  geom_point(data = filter(all_reading_scores_long, year > 2010), aes(x=year, y=score), position='jitter') +
  geom_point(size=4, color="red") +
  labs(x = "Year", y = "OECD Average Reading Scores") +
  ggtitle("OECD Average Reading Scores from 2012-2022")

ggplot(filter(all_math_scores_long, country == "OECD average"), aes(x=year, y=score)) + 
  geom_point(data = filter(all_math_scores_long, year > 2010), aes(x=year, y=score), position='jitter') +
  geom_point(size=4, color="red") +
  labs(x = "Year", y = "OECD Average Math Scores") +
  ggtitle("OECD Average Math Scores from 2012-2022")

ggplot(filter(all_science_scores_long, country == "OECD average"), aes(year, score)) + 
  geom_point(data = filter(all_science_scores_long, year > 2010), aes(x=year, y=score), position='jitter') +
  geom_point(size=4, color="red") +
  labs(x = "Year", y = "OECD Average Science Scores") +
  ggtitle("OECD Average Science Scores from 2012-2022")

# Change the x axis to only show the years we wanna see
```

- interesting to predict what 2022 would be given 2009-2018 (1) 

```{r}
# Reading Predictions
reading_scores_train <- all_reading_scores_long |>
  filter(year < 2020, country == "OECD average")
reading_model <- lm(score ~ year, data = reading_scores_train)

# Predict for 2022
predicted_value <- predict(reading_model, newdata = data.frame(year = 2022))
print(predicted_value)

# Plot new model
ggplot(reading_scores_train, aes(year, score)) + 
  geom_point(data=filter(all_reading_scores_long, country == "OECD average"), aes(year, score)) +
  geom_point(data=data.frame(year = 2022, score = predicted_value), color = "blue", size=3) +
  geom_abline(intercept = coef(reading_model)[1], slope = coef(reading_model)[2], 
              color = "blue", linewidth = 1) +
  labs(x = "Year", y = "OECD Average Reading Scores") +
  ggtitle("Predicting 2022 OECD Average Reading Score")
```

```{r}
# Math Predictions
math_scores_train <- all_math_scores_long |>
  filter(year < 2020, country == "OECD average")
math_model <- lm(score ~ year, data = math_scores_train)

# Predict for 2022
predicted_value <- predict(math_model, newdata = data.frame(year = 2022))
print(predicted_value)

# Plot new model
ggplot(math_scores_train, aes(year, score)) + 
  geom_point(data=filter(all_math_scores_long, country == "OECD average"), aes(year, score)) +
  geom_point(data=data.frame(year = 2022, score = predicted_value), color = "blue", size=3) +
  geom_abline(intercept = coef(math_model)[1], slope = coef(math_model)[2], 
              color = "blue", linewidth = 1) +
  labs(x = "Year", y = "OECD Average Mathematics Scores") +
  ggtitle("Predicting 2022 OECD Average Mathematics Score")
```
```{r}
# Science Predictions
science_scores_train <- all_science_scores_long |>
  filter(year < 2020, country == "OECD average")
science_model <- lm(score ~ year, data = science_scores_train)

# Predict for 2022
predicted_value <- predict(science_model, newdata = data.frame(year = 2022))
print(predicted_value)

# Plot new model
ggplot(science_scores_train, aes(year, score)) + 
  geom_point(data=filter(all_science_scores_long, country == "OECD average"), aes(year, score)) +
  geom_point(data=data.frame(year = 2022, score = predicted_value), color = "blue", size=3) +
  geom_abline(intercept = coef(science_model)[1], slope = coef(science_model)[2], 
              color = "blue", linewidth = 1) +
  labs(x = "Year", y = "OECD Average Science Scores") +
  ggtitle("Predicting 2022 OECD Average Science Score")
```

- GDP for 2018 vs 2022 (1)
```{r}
gdp_2018 <- read.csv('data/2018_GDP.csv') |>
  mutate(country = Country, score = Score, gdp = GDP, year="2018") |>
  select("country", "score", "gdp", "year")
gdp_2022 <- read.csv('data/2022_GDP.csv') |>
  left_join(filter(all_reading_scores_long, year == 2022), by=c("Country" = "country")) |>
  mutate(country = Country, gdp = GDP, year="2022") |>
  select("country", "score", "gdp", "year")

gdp <- bind_rows(gdp_2018, gdp_2022) 
# |>
  #pivot_wider(names_from = year, values_from = gdp, names_prefix = "gdp_", values_fn = first) |>
  #mutate(change = gdp_2022 - gdp_2018)

ggplot(gdp, aes(x = as.factor(year), y = gdp, group = country)) +
  geom_line(aes(color = country), linewidth = 1) +
  geom_point(size = 3) +
  labs(title = "GDP Trend: 2018 to 2022",
       x = "Year", y = "GDP") +
  theme(legend.position = "none") 
```


- spending for 2018 vs 2022 (1)

---> shit on countries 
---> see if there is a correlation between COVID and GDP, COVID and spending


```{r}
GDP_precovid<- read.csv('data/2018_GDP.csv')
spending_precovid<- read.csv('data/2018_Spending.csv')

merged_data <- merge(GDP_precovid, spending_precovid, by = "Country")
```




```{r}
library(ggplot2)
library(ggrepel)
library(scales) # Required for label_number()
#2018

# Define the specific countries you want to label
target_countries <- c("Qatar", "Macao (China)", "Singapore", "Austria", "Iceland",'Finland')

ggplot(merged_data, aes(x = GDP, y = Spending)) +
  geom_point(color = "blue", size = 2) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey50") +
  geom_smooth(method = "lm", se = FALSE, color = "darkred") +
  
  geom_text_repel(
    # Filter data to only label the target countries
    data = merged_data[merged_data$Country %in% target_countries, ], 
    aes(label = Country), 
    size = 3,                       
    segment.color = 'grey50',       
    segment.size = 0.2,             
    box.padding = unit(0.5, "lines"), 
    point.padding = unit(0.5, "lines"),
    force = 2
  ) +
  
  # Set X-axis limits and format (NO scientific notation)
  scale_x_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data$GDP) * 1.05) # Incorporate the limit here
  ) +
  
  # Set Y-axis limits and format (NO scientific notation)
  scale_y_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data$Spending) * 1.05) # Incorporate the limit here
  ) +
  
  # Labels and Theme
  labs(
    title = "GDP vs. Spending Correlation (2018) - Selected Countries Highlighted",
    x = "GDP (in currency units from table)",
    y = "Spending (in currency units from table)",
    caption = "Linear trend line (dark red) shows relationship. Dashed line (grey) is y=x."
  ) +
  theme_minimal() 

# dashed is y = x
```
```{r}

GDP_postcovid<- read.csv('data/2022_GDP.csv')
spending_postcovid<- read.csv('data/2022_Spending.csv')

merged_data2 <- merge(GDP_postcovid, spending_postcovid, by = "Country")
names(merged_data2)[2] <- "GDP"
```

```{r}
library(ggplot2)
library(ggrepel)
library(scales) # Required for label_number()

# Define the specific countries you want to label
target_countries <- c("Qatar", "Macao (China)", "Luxembourg", "Singapore", "Austria", "Iceland", 'Finland')

ggplot(merged_data2, aes(x = GDP, y = Spending)) +
  geom_point(color = "blue", size = 2) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey50") +
  geom_smooth(method = "lm", se = FALSE, color = "darkred") +
  
  geom_text_repel(
    # Filter data to only label the target countries
    data = merged_data2[merged_data2$Country %in% target_countries, ], 
    aes(label = Country), 
    size = 3,                       
    segment.color = 'grey50',       
    segment.size = 0.2,             
    box.padding = unit(0.5, "lines"), 
    point.padding = unit(0.5, "lines"),
    force = 2
  ) +
  
  # Set X-axis limits and format (NO scientific notation)
  scale_x_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data2$GDP) * 1.05) # Incorporate the limit here
  ) +
  
  # Set Y-axis limits and format (NO scientific notation)
  scale_y_continuous(
    labels = label_number(big.mark = ","), # Format to full number with commas
    limits = c(0, max(merged_data2$Spending) * 1.05) # Incorporate the limit here
  ) +
  
  # Labels and Theme
  labs(
    title = "GDP vs. Spending Correlation (2022) - Selected Countries Highlighted",
    x = "GDP (in currency units from table)",
    y = "Spending (in currency units from table)",
    caption = "Linear trend line (dark red) shows relationship. Dashed line (grey) is y=x."
  ) +
  theme_minimal() 

# dashed is y = x
```



#### school modality 
- bar graph for the states (1)
- mosaic for the modality (3 categories) (1)

```{r}

#### school modality 
library(dplyr)
library(forcats)
library(vcd)
#https://healthdata.gov/browse?q=school+learning+modalities&sortBy=relevance&pageSize=20

df <- read.csv("data/school_modality.csv") |>
  mutate(
    Learning_Modality = as.factor(Learning_Modality),
    Year = as.factor(Year)
  )

counts <- df |>
  group_by(Year, Learning_Modality) |>
  summarize(Freq = sum(Count), .groups = "drop")

tbl <- xtabs(Freq ~ Year + Learning_Modality, data = counts)

colors_theme <- c("#FFB6B9", "#FAE3D9", "#61C0BF")

mosaic(
  tbl,
  direction = c("v", "h"),
  highlighting = "Learning_Modality",
  highlighting_fill = colors_theme,
  main = "Learning Modality by Year")
```
- from 2020 to 2022, the USA changed learning modality due to pandemic
- by the end of 2022, schools were back to hybrid
- "K-12 public and independent charter school districts for the 2021-2022 school year and the Fall 2022 semester, from August 2021 â€“ December 2022"

```{r}

usaburnout <- read.csv("data/USA_burnout.csv")
ggplot(data = usaburnout, aes(x = Year, y = High_School)) +
  geom_line(linewidth = 1) + 
  geom_point(size = 3) + 
  
  expand_limits(y = 0) + 
 
  labs(
    title = "Student Burnout (Persistent Sadness) Trends: USA",
    y = "Percent of Students (%)",
    x = "Year"
  ) +
  theme_minimal() +
  
  # Customize the color legend title
  scale_color_discrete(name = "Country")
# 2020 vertical line to signify the start of pandemic 
# some kinda predictive thing to show that predicted value for 2021 is lower than actual to show hella increase in slope

```
- check the steady increase from 2019 to 2021 (COVID TIME)
- could be because of the stress of pandemic and changes in school modality (refer to mosaic)

```{r}
data <- read.csv("data/school_burnout_finland.csv")
data_long <- data %>%
  rename(
    High_school = colnames(data)[4]
  )
```


```{r}

library(tidyverse)
library(ggplot2)


# 4. Create the Line Plot using ggplot2
# Option A: Recommended Method (using expand_limits)
ggplot(data = data_long, aes(x = Year, y = High_school)) +
  geom_line(linewidth = 1) + 
  geom_point(size = 3) + 
  
  # ðŸ‘‡ This forces the y-axis to include 0
  expand_limits(y = 0) + 
  
  # Add labels and theme... (rest of the code remains the same)
  labs(
    title = "Student Burnout (Persistent Sadness) Trends: Finland",
    y = "Percent of Students (%)",
    x = "Year"
  ) +
  theme_minimal() +
  
  # Customize the color legend title
  scale_color_discrete(name = "Country")

# 2020 vertical line to signify the start of pandemic 
# some kinda predictive thing to show that predicted value for 2021 is lower than actual to show hella increase in slope
```
The transition to distance learning during the pandemic led to decreased engagement among students, teachers, and principals.

This shift significantly increased stress and burnout for educators, with principals feeling the effects of their teachers' struggles. Teachers found it difficult to compensate for the inconsistent support students received back home.

The switch to distance learning was well-organized, but it ultimately made fairness in education worse and damaged the conditions needed for students to learn well and feel supported.

- graph shows spike from 2019-2021


```{r}
data_cynicism <- read.csv("data/cynicism_finland.csv")
data_cynicism <- data_cynicism %>%
  rename(
    High_school = colnames(data_cynicism)[4],
  )

# Load the necessary libraries (if not already loaded)
library(tidyr) 
library(ggplot2)

# Convert data to long format for easier plotting
data_cynicism_long <- data_cynicism %>%
  pivot_longer(
    # Select the three school columns for pivoting
    cols = c(High_school),
    names_to = "School_Type",
    values_to = "Percentage"
  )


color_map <- c(
  "High_school" = "#6495ED"  
)

label_map <- c(
  "Comprehensive" = "Comprehensive school grades 8 and 9",
  "High_school" = "High school grades 10 and 11",
  "Vocational" = "Vocational school"
)

# Create the plot
cynicism_plot <- ggplot(data_cynicism_long, aes(x = Year, y = Percentage, color = School_Type)) +
  # Add the lines
  geom_line(linewidth = 1) +
  # Add the points (circles)
  geom_point(size = 3) +
  
  # Set the custom colors and labels for the legend
  scale_color_manual(
    values = color_map, 
    labels = label_map,
    name = NULL # Remove legend title
  ) +
  
  # Customize the X-axis (Years)
  scale_x_continuous(
    breaks = data_cynicism$Year,
    # Use the custom labels, noting 2013 and 2017 are single years in this set
    labels = c("2007", "2009", "2011", "2013", "2017", "2019", "2021"),
    expand = expansion(add = c(0.5, 0.5))
  ) +
  
  # Customize the Y-axis (Percentage) - Adjusted for higher values
  scale_y_continuous(
    limits = c(0, 40), # Set the y-axis range to accommodate up to 35.5
    breaks = seq(0, 40, by = 5) # Set breaks every 5 units
  ) +
  
  # Add labels
  labs(
    x = "Year",
    y = "Percentage of students reporting cynicism"
  ) +
  
  # Apply the clean theme
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.title = element_text(size = 12, face = "bold"),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "grey80"),
    panel.grid.minor = element_blank()
  )
# Display the plot
print(cynicism_plot)

# 2020 vertical line to signify the start of pandemic 
# some kinda predictive thing to show that predicted value for 2021 is lower than actual to show hella increase in slope
```
```{r}
pisa_gdp2018 = inner_join(read.csv("data/2018_GDP.csv"), read.csv("data/2018_PISA.csv"), by = "Country") %>%
  select(Country, Score, GDP)

library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(patchwork)

name_fix <- c(
  "United States" = "United States of America",
  "South Korea" = "Korea, Republic of",
  "North Korea" = "Korea, Democratic People's Republic of",
  "Iran" = "Iran, Islamic Republic of",
  "Vietnam" = "Viet Nam",
  "Egypt" = "Egypt, Arab Republic of",
  "Czech Republic" = "Czechia",
  "Syria" = "Syrian Arab Republic",
  "Bolivia" = "Bolivia (Plurinational State of)",
  "Brunei Darussalam" = "Brunei",
  "Slovak Republic" = "Slovakia",
  "Korea" = "South Korea",
  "Baku (Azerbaijan)" = "Azerbaijan",
  "Moldova" = "Moldova",       
  "Kosovo" = "Kosovo")

pisa_gdp2018$Country <- recode(pisa_gdp2018$Country, !!!name_fix)

world <- ne_countries(scale = "medium", returnclass = "sf")

world_data <- world %>%
  left_join(pisa_gdp2018, by = c("name" = "Country"))

map_gdp <- ggplot(world_data) +
  geom_sf(aes(fill = GDP), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "gray90") +
  labs(
    title = "GDP by Country",
    fill = "GDP"
  ) +
  theme_minimal()

map_score <- ggplot(world_data) +
  geom_sf(aes(fill = Score), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "gray90") +
  labs(
    title = "PISA Score by Country",
    fill = "Score"
  ) +
  theme_minimal()
map_gdp

map_score

```

```{r}
pisa_gdp2022 = inner_join(read.csv("data/2022_GDP.csv"), read.csv("data/2022_PISA.csv"), by = "Country") %>%
  select(Country,GDP)

library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(patchwork)

name_fix <- c(
  "United States" = "United States of America",
  "South Korea" = "Korea, Republic of",
  "North Korea" = "Korea, Democratic People's Republic of",
  "Iran" = "Iran, Islamic Republic of",
  "Vietnam" = "Viet Nam",
  "Egypt" = "Egypt, Arab Republic of",
  "Czech Republic" = "Czechia",
  "Syria" = "Syrian Arab Republic",
  "Bolivia" = "Bolivia (Plurinational State of)",
  "Brunei Darussalam" = "Brunei",
  "Slovak Republic" = "Slovakia",
  "Korea" = "South Korea",
  "Baku (Azerbaijan)" = "Azerbaijan",
  "Moldova" = "Moldova",       
  "Kosovo" = "Kosovo")

pisa_gdp2022$Country <- recode(pisa_gdp2022$Country, !!!name_fix)

world <- ne_countries(scale = "medium", returnclass = "sf")

world_data <- world %>%
  left_join(pisa_gdp2018, by = c("name" = "Country"))

map_gdp <- ggplot(world_data) +
  geom_sf(aes(fill = GDP), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "gray90") +
  labs(
    title = "GDP by Country",
    fill = "GDP"
  ) +
  theme_minimal()

map_score <- ggplot(world_data) +
  geom_sf(aes(fill = Score), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "gray90") +
  labs(
    title = "PISA Score by Country",
    fill = "Score"
  ) +
  theme_minimal()
map_gdp
map_score
```
- create heatmap
- create chloropleth for the missing countries for all the PISA years 


#- spending vs pisa 



